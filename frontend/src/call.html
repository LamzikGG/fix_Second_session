<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вызов</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #2d2d2d;
            color: #fff;
            padding: 20px;
        }
        
        .call-container {
            text-align: center;
        }
        
        .call-type {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
        }
        
        .caller-name {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .call-time {
            font-size: 12px;
            color: #888;
            margin-bottom: 30px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .btn.accept {
            background: #28a745;
        }
        
        .btn.accept:hover {
            background: #218838;
            transform: scale(1.05);
        }
        
        .btn.decline {
            background: #dc3545;
        }
        
        .btn.decline:hover {
            background: #c82333;
            transform: scale(1.05);
        }
        
        .btn svg {
            width: 40px;
            height: 40px;
        }
        
        .btn.accept svg path {
            fill: white;
        }
        
        .btn.decline svg path {
            fill: white;
        }
    </style>
</head>
<body>
    <div class="call-container">
        <div class="call-type" id="call-type">Вызов</div>
        <div class="caller-name" id="caller-name">Пользователь</div>
        <div class="call-time" id="call-time">00:00</div>
        
        <div class="controls">
            <button class="btn decline" id="decline-btn">
                <svg viewBox="0 0 24 24">
                    <path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z" fill="white"/>
                </svg>
            </button>
            <button class="btn accept" id="accept-btn">
                <svg viewBox="0 0 24 24">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="white"/>
                </svg>
            </button>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        
        let callData = null;
        let timerInterval = null;
        let startTime = Date.now();
        
        ipcRenderer.on('call-data', (event, data) => {
            console.log('Call data received:', data);
            callData = data;
            
            document.getElementById('call-type').textContent = 
                data.call_type === 'video' ? 'Видеозвонок' : 'Аудиозвонок';
            document.getElementById('caller-name').textContent = data.initiator_name || 'Пользователь';
            
            startTime = Date.now();
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
        });
        
        document.getElementById('accept-btn').onclick = () => {
            console.log('Accept call');
            ipcRenderer.send('call-response', {
                action: 'accept',
                call_id: callData?.call_id,
                sdp: null
            });
            window.close();
        };
        
        document.getElementById('decline-btn').onclick = () => {
            console.log('Decline call');
            ipcRenderer.send('call-response', {
                action: 'decline',
                call_id: callData?.call_id
            });
            window.close();
        };
        
        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('call-time').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        window.addEventListener('beforeunload', () => {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
        });
    </script>
</body>
</html>